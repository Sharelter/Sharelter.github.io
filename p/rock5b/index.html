<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Rock and Roll!"><title>Rock5b试玩</title><link rel=canonical href=https://sharelter.github.io/p/rock5b/><link rel=stylesheet href=/scss/style.min.8191399262444ab68b72a18c97392f5349be20a1615d77445be51e974c144cff.css><meta property="og:title" content="Rock5b试玩"><meta property="og:description" content="Rock and Roll!"><meta property="og:url" content="https://sharelter.github.io/p/rock5b/"><meta property="og:site_name" content="Sharelter"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="toss"><meta property="article:published_time" content="2023-03-14T15:45:24+08:00"><meta property="article:modified_time" content="2023-03-14T15:45:24+08:00"><meta property="og:image" content="https://sharelter.github.io/p/rock5b/rock5b.jpg"><meta name=twitter:title content="Rock5b试玩"><meta name=twitter:description content="Rock and Roll!"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sharelter.github.io/p/rock5b/rock5b.jpg"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/sharelter-avatar_hub1f71be9b71dd17b212d94ded2d9ce34_23100_300x0_resize_q75_box.jpeg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>🍥</span></figure><div class=site-meta><h1 class=site-name><a href=/>Sharelter</a></h1><h2 class=site-description>喵～</h2></div></header><ol class=social-menu><li><a href=https://github.com/Sharelter target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/friend-links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Friend Links</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#烧录系统到sd卡并启动>烧录系统到SD卡并启动</a></li><li><a href=#电源>电源</a></li><li><a href=#cpu>CPU</a></li><li><a href=#内存>内存</a></li><li><a href=#hdmi输出>HDMI输出</a></li><li><a href=#armbian>Armbian</a></li><li><a href=#从nvme启动>从NVME启动</a></li><li><a href=#gpu-硬件解码>GPU 硬件解码</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/rock5b/><img src=/p/rock5b/rock5b_hu3436fbf640afd80aff29571cebe681b5_324530_800x0_resize_q75_box.jpg srcset="/p/rock5b/rock5b_hu3436fbf640afd80aff29571cebe681b5_324530_800x0_resize_q75_box.jpg 800w, /p/rock5b/rock5b_hu3436fbf640afd80aff29571cebe681b5_324530_1600x0_resize_q75_box.jpg 1600w" width=800 height=581 loading=lazy alt="Featured image of post Rock5b试玩"></a></div><div class=article-details><header class=article-category><a href=/categories/tech/ style=background-color:orange;color:#fff>Tech</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/rock5b/>Rock5b试玩</a></h2><h3 class=article-subtitle>Rock and Roll!</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Mar 14, 2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>9 minute read</time></div></footer></div></header><section class=article-content><p>本文记录了 ROCK5B (RK3588) 的开箱记录，以及遇到的问题及解决方法</p><h2 id=烧录系统到sd卡并启动>烧录系统到SD卡并启动</h2><p>按照 <a class=link href=https://wiki.radxa.com/Rock5/5b/getting_started target=_blank rel=noopener>https://wiki.radxa.com/Rock5/5b/getting_started</a> 下载并烧录系统，这里先测试下 ubuntu(server 版本）（不建议一开始使用这个系统，bug多，先用debian或者 armbian（推荐） 或者 安卓， 安卓是最好上手的）。</p><p>这里系统盘制作好了会发现磁盘最后面有一段空闲分区，不用手动去扩展，ubuntu 系统第一次启动会自动扩容根目录到卡的最大空间。</p><p>可以使用串口模块查看日志，串口连接（波特率是 1500000 ，可能有些串口模块不支持这么高的波特率）</p><p><img src=/p/rock5b/seriel_1.jpg width=420 height=250 srcset="/p/rock5b/seriel_1_hu67a056f236c41c9b53e2384f318a538a_70015_480x0_resize_q75_box.jpg 480w, /p/rock5b/seriel_1_hu67a056f236c41c9b53e2384f318a538a_70015_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt=seriel_1.jpg class=gallery-image data-flex-grow=168 data-flex-basis=403px></p><p>但是日志是不完全的，因为默认系统都关闭了日志打印，也不能看到什么消息</p><p>Ubuntu 第一次开机 会一直循环</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    [    9.952843] BUG: spinlock bad magic on CPU#1, systemd-udevd/433
</span></span><span class=line><span class=cl>    [    9.957383]  lock: 0xffffffc012b26080, .magic: 00000000, .owner: &lt;none&gt;/-1, .owner_cpu: 0
</span></span><span class=line><span class=cl>    [   12.590411] reboot: Restarting system
</span></span><span class=line><span class=cl>    DDR Version V1.08 20220617
</span></span><span class=line><span class=cl>    LPDDR4X, 2112MHz
</span></span><span class=line><span class=cl>    channel[0] BW=16 Col=10 Bk=8 CS0 Row=17 CS1 Row=17 CS=2 Die BW=8 Size=4096MB
</span></span><span class=line><span class=cl>    channel[1] BW=16 Col=10 Bk=8 CS0 Row=17 CS1 Row=17 CS=2 Die BW=8 Size=4096MB
</span></span><span class=line><span class=cl>    channel[2] BW=16 Col=10 Bk=8 CS0 Row=17 CS1 Row=17 CS=2 Die BW=8 Size=4096MB
</span></span><span class=line><span class=cl>    channel[3] BW=16 Col=10 Bk=8 CS0 Row=17 CS1 Row=17 CS=2 Die BW=8 Size=4096MB
</span></span><span class=line><span class=cl>    Manufacturer ID:0x6 
</span></span><span class=line><span class=cl>    CH0 RX Vref:28.7%, TX Vref:24.8%,25.8%
</span></span><span class=line><span class=cl>    CH1 RX Vref:28.7%, TX Vref:24.8%,23.8%
</span></span><span class=line><span class=cl>    CH2 RX Vref:27.7%, TX Vref:24.8%,23.8%
</span></span><span class=line><span class=cl>    CH3 RX Vref:29.7%, TX Vref:24.8%,24.8%
</span></span><span class=line><span class=cl>    change to F1: 528MHz
</span></span><span class=line><span class=cl>    change to F2: 1068MHz
</span></span><span class=line><span class=cl>    change to F3: 1560MHz
</span></span><span class=line><span class=cl>    change to F0: 2112MHz
</span></span><span class=line><span class=cl>    out
</span></span><span class=line><span class=cl>    INFO:    Preloader serial: 2
</span></span><span class=line><span class=cl>    NOTICE:  BL31: v2.3():v2.3-405-gb52c2eadd:derrick.huang
</span></span><span class=line><span class=cl>    NOTICE:  BL31: Built : 11:23:47, Aug 15 2022
</span></span><span class=line><span class=cl>    INFO:    spec: 0x1
</span></span><span class=line><span class=cl>    INFO:    ext 32k is not valid
</span></span><span class=line><span class=cl>    INFO:    GICv3 without legacy support detected.
</span></span><span class=line><span class=cl>    INFO:    ARM GICv3 driver initialized in EL3
</span></span><span class=line><span class=cl>    INFO:    system boots from cpu-hwid-0
</span></span><span class=line><span class=cl>    INFO:    idle_st=0x21fff, pd_st=0x11fff9, repair_st=0xfff70001
</span></span><span class=line><span class=cl>    INFO:    dfs DDR fsp_params[0].freq_mhz= 2112MHz
</span></span><span class=line><span class=cl>    INFO:    dfs DDR fsp_params[1].freq_mhz= 528MHz
</span></span><span class=line><span class=cl>    INFO:    dfs DDR fsp_params[2].freq_mhz= 1068MHz
</span></span><span class=line><span class=cl>    INFO:    dfs DDR fsp_params[3].freq_mhz= 1560MHz
</span></span><span class=line><span class=cl>    INFO:    BL31: Initialising Exception Handling Framework
</span></span><span class=line><span class=cl>    INFO:    BL31: Initializing runtime services
</span></span><span class=line><span class=cl>    WARNING: No OPTEE provided by BL2 boot loader, Booting device without OPTEE initialization. SMC`s destined for OPTEE will return SMC_UNK
</span></span><span class=line><span class=cl>    ERROR:   Error initializing runtime service opteed_fast
</span></span><span class=line><span class=cl>    INFO:    BL31: Preparing for EL3 exit to normal world
</span></span><span class=line><span class=cl>    INFO:    Entry point address = 0x200000
</span></span><span class=line><span class=cl>    INFO:    SPSR = 0x3c9
</span></span><span class=line><span class=cl>    [   10.314850] BUG: spinlock bad magic on CPU#5, systemd-udevd/394
</span></span><span class=line><span class=cl>    [   10.316119]  lock: 0xffffffc012b05080, .magic: 00000000, .owner: &lt;none&gt;/-1, .owner_cpu: 0
</span></span></code></pre></td></tr></table></div></div><p>用了诱骗器让充电器输出固定的12V,就能跑起来</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    [   10.305132] BUG: spinlock bad magic on CPU#7, systemd-udevd/379
</span></span><span class=line><span class=cl>    [   10.305139]  lock: 0xffffffc012a25080, .magic: 00000000, .owner: &lt;none&gt;/-1, .owner_cpu: 0
</span></span></code></pre></td></tr></table></div></div><p>HDMI 插上也没有反应，串口终端</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    [  723.967060] rockchip-hdptx-phy-hdmi fed70000.hdmiphy: hdptx phy pll locked!
</span></span><span class=line><span class=cl>    [  723.967381] rockchip-hdptx-phy-hdmi fed70000.hdmiphy: hdptx phy lane locked!
</span></span><span class=line><span class=cl>    [  726.353844] Buffer I/O error on device mmcblk0p2, logical block 12289
</span></span><span class=line><span class=cl>    [  726.354406] Buffer I/O error on device mmcblk0p2, logical block 141311
</span></span><span class=line><span class=cl>    [  726.354819] Buffer I/O error on device mmcblk0p2, logical block 141312
</span></span><span class=line><span class=cl>    [  726.355469] Buffer I/O error on device mmcblk0p2, logical block 141318
</span></span><span class=line><span class=cl>    [  726.355885] Buffer I/O error on device mmcblk0p2, logical block 141319
</span></span><span class=line><span class=cl>    [  726.356330] Buffer I/O error on device mmcblk0p2, logical block 141323
</span></span><span class=line><span class=cl>    [  726.356738] Buffer I/O error on device mmcblk0p2, logical block 141324
</span></span><span class=line><span class=cl>    [  726.357180] Buffer I/O error on device mmcblk0p2, logical block 141326
</span></span><span class=line><span class=cl>    [  726.357586] Buffer I/O error on device mmcblk0p2, logical block 141327
</span></span><span class=line><span class=cl>    [  726.357992] Buffer I/O error on device mmcblk0p2, logical block 141328
</span></span><span class=line><span class=cl>    [  726.363448] Aborting journal on device mmcblk0p2-8.
</span></span><span class=line><span class=cl>    [  726.363592] JBD2: Error -5 detected when updating journal superblock for mmcblk0p2-8.
</span></span><span class=line><span class=cl>    [  726.364213] EXT4-fs (mmcblk0p2): I/O error while writing superblock
</span></span><span class=line><span class=cl>    [  726.364331] EXT4-fs error (device mmcblk0p2): ext4_journal_check_start:83: Detected aborted journal
</span></span><span class=line><span class=cl>    [  726.364484] EXT4-fs (mmcblk0p2): Remounting filesystem read-only
</span></span><span class=line><span class=cl>    [  726.364594] EXT4-fs (mmcblk0p2): ext4_writepages: jbd2_start: 9223372036854775779 pages, ino 11320; err -30
</span></span><span class=line><span class=cl>    [  726.418700] JBD2: Error while async write back metadata bh 814.
</span></span><span class=line><span class=cl>    [  726.428108] EXT4-fs error (device mmcblk0p2): __ext4_find_entry:1611: inode #4508: comm systemd-udevd: reading directory lblock 0
</span></span><span class=line><span class=cl>    [  726.428414] EXT4-fs (mmcblk0p2): I/O error while writing superblock
</span></span><span class=line><span class=cl>    [  726.428590] EXT4-fs error (device mmcblk0p2): __ext4_find_entry:1611: inode #548: comm systemd-udevd: reading directory lblock 0
</span></span><span class=line><span class=cl>    [  726.428767] EXT4-fs (mmcblk0p2): I/O error while writing superblock
</span></span><span class=line><span class=cl>    [  726.428883] EXT4-fs error (device mmcblk0p2): __ext4_find_entry:1611: inode #2119: comm systemd-udevd: reading directory lblock 0
</span></span><span class=line><span class=cl>    [  726.429062] EXT4-fs error (device mmcblk0p2): __ext4_find_entry:1611: inode #2: comm systemd-udevd: reading directory lblock 0
</span></span><span class=line><span class=cl>    [  726.429233] EXT4-fs error (device mmcblk0p2): __ext4_find_entry:1611: inode #4508: comm systemd-udevd: reading directory lblock 0
</span></span></code></pre></td></tr></table></div></div><p>这读取文件系统错误，有可能TF卡松动了，裸板的设计，没有外壳的时候TF卡确实很容易松动， 断电插紧重启即可</p><p>运行一会儿后又出现了问题。。。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    [ 1147.255838] rk806 spi2.0: SPI transfer timed out
</span></span><span class=line><span class=cl>    [ 1147.263313] spi_master spi2: failed to transfer one message from queue
</span></span><span class=line><span class=cl>    [ 1147.270938] cpu cpu0: rockchip_cpufreq_set_volt: failed to set voltage (925000 925000 950000 uV): -11
</span></span><span class=line><span class=cl>    [ 1147.278907] cpufreq: __target_index: Failed to change cpu frequency: -110
</span></span><span class=line><span class=cl>    [ 1147.489206] rk806 spi2.0: SPI transfer timed out
</span></span></code></pre></td></tr></table></div></div><p>rk806 貌似是电源管理 IC，看样子有可能是充电协议握手出现了啥问题，先不管，断电重启，之后再说。</p><p>更换国内源，比如中科大 <code>mirrors.ustc.edu.cn</code>，编辑 <code>/etc/apt/sources.list</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    deb http://mirrors.ustc.edu.cn/ubuntu-ports/ focal main restricted universe multiverse
</span></span><span class=line><span class=cl>    #deb-src http://mirrors.ustc.edu.cn/ubuntu-ports/ focal main restricted universe multiverse
</span></span><span class=line><span class=cl>    deb http://mirrors.ustc.edu.cn/ubuntu-ports/ focal-security main restricted universe multiverse
</span></span><span class=line><span class=cl>    #deb-src http://mirrors.ustc.edu.cn/ubuntu-ports/ focal-security main restricted universe multiverse
</span></span><span class=line><span class=cl>    deb http://mirrors.ustc.edu.cn/ubuntu-ports/ focal-updates main restricted universe multiverse
</span></span><span class=line><span class=cl>    #deb-src http://mirrors.ustc.edu.cn/ubuntu-ports/ focal-updates main restricted universe multiverse
</span></span><span class=line><span class=cl>    deb http://mirrors.ustc.edu.cn/ubuntu-ports/ focal-backports main restricted universe multiverse
</span></span><span class=line><span class=cl>    #deb-src http://mirrors.ustc.edu.cn/ubuntu-ports/ focal-backports main restricted universe multiverse
</span></span></code></pre></td></tr></table></div></div><p><code>apt update</code>发现报错, 又报错了</p><p>按照通用做法</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo gpg --keyserver keyserver.ubuntu.com --recv-keys 9B98116C9AA302C7
</span></span></code></pre></td></tr></table></div></div><p>报错 gpg: keyserver receive failed: No data，于是去apt.radxa.com源看看</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    wget -O - apt.radxa.com/focal-stable/public.key | sudo apt-key add -
</span></span></code></pre></td></tr></table></div></div><h2 id=电源>电源</h2><p>PMU 是通过 I2C 连接到芯片的，可以在系统看到当前协商的电压：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    sensors tcpm_source_psy_4_0022-i2c-4-22
</span></span></code></pre></td></tr></table></div></div><p>以及可以看到 typec 的相关信息</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    grep &#34;&#34; /sys/class/typec/port0/* 2&gt;/dev/null
</span></span></code></pre></td></tr></table></div></div><p>实际电压可以(需要除以~172.5)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    awk &#39;{printf (&#34;%0.2f\n&#34;,$1/172.5); }&#39; &lt;/sys/devices/iio_sysfs_trigger/subsystem/devices/iio\:device0/in_voltage6_raw
</span></span><span class=line><span class=cl>    11.98
</span></span></code></pre></td></tr></table></div></div><h2 id=cpu>CPU</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    cat /proc/cpuinfo
</span></span><span class=line><span class=cl>    sudo apt-get install cpufrequtils
</span></span><span class=line><span class=cl>    sudo cpufreq-info
</span></span></code></pre></td></tr></table></div></div><p>可以看到最大频率为 2.4GHz， 以及 4个小核 1.8GHz
用 7z 在没有风扇的情况下先跑个分看看情况，跑起来手摸cpu盖子还是很烫的</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    $ apt install p7zip
</span></span><span class=line><span class=cl>    $ 7zr b
</span></span><span class=line><span class=cl>    7-Zip (a) [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21
</span></span><span class=line><span class=cl>    p7zip Version 16.02 (locale=C.UTF-8,Utf16=on,HugeFiles=on,64 bits,8 CPUs LE)
</span></span><span class=line><span class=cl>    LE
</span></span><span class=line><span class=cl>    CPU Freq: 64000000 - - - - - - - -
</span></span><span class=line><span class=cl>    RAM size:   15722 MB,  # CPU hardware threads:   8
</span></span><span class=line><span class=cl>    RAM usage:   1765 MB,  # Benchmark threads:      8
</span></span><span class=line><span class=cl>                           Compressing  |                  Decompressing
</span></span><span class=line><span class=cl>    Dict     Speed Usage    R/U Rating  |      Speed Usage    R/U Rating
</span></span><span class=line><span class=cl>             KiB/s     %   MIPS   MIPS  |      KiB/s     %   MIPS   MIPS
</span></span><span class=line><span class=cl>    22:      13939   726   1867  13560  |     199330   682   2494  17002
</span></span><span class=line><span class=cl>    23:      13416   748   1828  13670  |     193846   684   2452  16775
</span></span><span class=line><span class=cl>    24:      12832   759   1818  13797  |     186688   681   2406  16385
</span></span><span class=line><span class=cl>    25:      12244   758   1846  13980  |     179663   680   2350  15989
</span></span><span class=line><span class=cl>    ----------------------------------  | ------------------------------
</span></span><span class=line><span class=cl>    Avr:             748   1840  13752  |              682   2426  16538
</span></span><span class=line><span class=cl>    Tot:             715   2133  15145
</span></span></code></pre></td></tr></table></div></div><p>可以看到这里的 speed 和 rating 是树莓派4B 的至少 3 倍了</p><p>尝试看看温度，用 ssh 登录试试，串口执行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ifconfig
</span></span></code></pre></td></tr></table></div></div><p>看到ip，然后<code>ssh root@ip</code>输入密码<code>root</code>，报错<code>Permission denied, please try again.</code>，在串口终端修改密码<code>passwd root</code>为<code>root</code>，还是不行，可能默认设置不允许 root 用户登录，修改<code>vim /etc/ssh/sshd_config</code> 添加<code>PermitRootLogin yes </code>后 重启服务<code>systemctl restart sshd</code>即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    watch -n 0.1 cat /sys/class/thermal/thermal_zone0/temp
</span></span></code></pre></td></tr></table></div></div><p>同时跑分，温度最高跑到了72℃，还是很凉快的。
同时，看一下频率是否跑满了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>watch -n 0.1 cpufreq-info -f -c 4
</span></span></code></pre></td></tr></table></div></div><blockquote><p>这里 -c 指令核心 id， 可以看到跑分时频率为 2400000Hz 或者 1800000Hz</p></blockquote><p>到此为止，你以为真的跑到 2.4GHz 了吗，99.99%的可能并没有，只是显示 2.4GHz，最开始这个开发板甚至内置了一个测试软件来抽奖看自己买到的 CPU 处于什么水平。。。
RK在rk35系列使用了<code> PVTM (Process-Voltage-Temperature Monitor) （PVT）</code>来监控系统状态，有一个 MCU 专门来控制频率CPU 频率，以及 NPU GPU</p><p>Link: <a class=link href=https://www.cnx-software.com/2022/07/17/what-is-pvtm-or-why-your-rockchip-rk3588-cpu-may-not-reach-2-4-ghz/ target=_blank rel=noopener>What is PVTM? Or why your Rockchip RK3588 CPU may not reach 2.4 GHz</a></p><p>Link: <a class=link href=cpufreq-rockchip.txt>cpufreq-rockchip.txt</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    rock@rock-5b:~$ dmesg |grep pvtm
</span></span><span class=line><span class=cl>    [    8.110543] rockchip-pvtm fda40000.pvtm: pvtm@0 probed
</span></span><span class=line><span class=cl>    [    8.110598] rockchip-pvtm fda50000.pvtm: pvtm@1 probed
</span></span><span class=line><span class=cl>    [    8.110647] rockchip-pvtm fda60000.pvtm: pvtm@2 probed
</span></span><span class=line><span class=cl>    [    8.110693] rockchip-pvtm fdaf0000.pvtm: pvtm@3 probed
</span></span><span class=line><span class=cl>    [    8.110736] rockchip-pvtm fdb30000.pvtm: pvtm@4 probed
</span></span><span class=line><span class=cl>    [    9.051869] cpu cpu0: pvtm=1456
</span></span><span class=line><span class=cl>    [    9.051948] cpu cpu0: pvtm-volt-sel=2
</span></span><span class=line><span class=cl>    [    9.060591] cpu cpu4: pvtm=1705
</span></span><span class=line><span class=cl>    [    9.064527] cpu cpu4: pvtm-volt-sel=4
</span></span><span class=line><span class=cl>    [    9.073916] cpu cpu6: pvtm=1724
</span></span><span class=line><span class=cl>    [    9.077872] cpu cpu6: pvtm-volt-sel=5
</span></span><span class=line><span class=cl>    [    9.162917] mali fb000000.gpu: pvtm=877
</span></span><span class=line><span class=cl>    [    9.162950] mali fb000000.gpu: pvtm-volt-sel=3
</span></span><span class=line><span class=cl>    [    9.346530] RKNPU fdab0000.npu: pvtm=880
</span></span><span class=line><span class=cl>    [    9.351791] RKNPU fdab0000.npu: pvtm-volt-sel=3
</span></span></code></pre></td></tr></table></div></div><p>看不太懂，不知道每个数值对应了什么级别的频率</p><p>上面的信息是由内核报告的 <code>Operating Performance Point (OPP)</code>, 但是实际跑的频率通过 <code>ThomasKaiser/SBC-Bench.sh</code> 可以获得（内置的armbian-config命令中集成了此工具的，可以直接用），比如我的</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    Checking cpufreq OPP for cpu0-cpu3 (Cortex-A55):
</span></span><span class=line><span class=cl>    Cpufreq OPP: 1800    Measured: 1798 (1798.646/1798.490/1798.372)
</span></span><span class=line><span class=cl>    Cpufreq OPP: 1608    Measured: 1614 (1614.427/1614.033/1613.875)
</span></span><span class=line><span class=cl>    Cpufreq OPP: 1416    Measured: 1414 (1415.323/1414.869/1414.627)
</span></span><span class=line><span class=cl>    Cpufreq OPP: 1200    Measured: 1233 (1233.787/1233.729/1233.585)     (+2.8%)
</span></span><span class=line><span class=cl>    Cpufreq OPP: 1008    Measured: 1007 (1007.980/1007.956/1007.524)
</span></span><span class=line><span class=cl>    Cpufreq OPP:  816    Measured:  806    (806.096/806.077/806.039)     (-1.2%)
</span></span><span class=line><span class=cl>    Cpufreq OPP:  600    Measured:  589    (589.884/589.422/589.281)     (-1.8%)
</span></span><span class=line><span class=cl>    Cpufreq OPP:  408    Measured:  391    (391.542/391.489/391.356)     (-4.2%)
</span></span><span class=line><span class=cl>    Checking cpufreq OPP for cpu4-cpu5 (Cortex-A76):
</span></span><span class=line><span class=cl>    Cpufreq OPP: 2400    Measured: 2227 (2227.990/2227.846/2227.750)     (-7.2%)
</span></span><span class=line><span class=cl>    Cpufreq OPP: 2208    Measured: 2161 (2162.236/2161.558/2161.286)     (-2.1%)
</span></span><span class=line><span class=cl>    Cpufreq OPP: 2016    Measured: 1998 (1998.559/1998.559/1998.414)
</span></span><span class=line><span class=cl>    Cpufreq OPP: 1800    Measured: 1826 (1826.351/1826.351/1826.271)     (+1.4%)
</span></span><span class=line><span class=cl>    Cpufreq OPP: 1608    Measured: 1623 (1623.824/1623.824/1623.744)
</span></span><span class=line><span class=cl>    Cpufreq OPP: 1416    Measured: 1442 (1442.152/1442.089/1441.869)     (+1.8%)
</span></span><span class=line><span class=cl>    Cpufreq OPP: 1200    Measured: 1197 (1197.094/1197.094/1196.904)
</span></span><span class=line><span class=cl>    Cpufreq OPP: 1008    Measured: 1002 (1002.915/1002.132/1002.060)
</span></span><span class=line><span class=cl>    Cpufreq OPP:  816    Measured:  807    (808.040/806.980/806.826)     (-1.1%)
</span></span><span class=line><span class=cl>    Cpufreq OPP:  600    Measured:  592    (592.867/592.828/592.802)     (-1.3%)
</span></span><span class=line><span class=cl>    Cpufreq OPP:  408    Measured:  394    (394.914/394.905/394.842)     (-3.4%)
</span></span><span class=line><span class=cl>    Checking cpufreq OPP for cpu6-cpu7 (Cortex-A76):
</span></span><span class=line><span class=cl>    Cpufreq OPP: 2400    Measured: 2243 (2244.059/2243.815/2243.718)     (-6.5%)
</span></span><span class=line><span class=cl>    Cpufreq OPP: 2208    Measured: 2160 (2160.970/2160.925/2160.744)     (-2.2%)
</span></span><span class=line><span class=cl>    Cpufreq OPP: 2016    Measured: 1990 (1990.232/1990.040/1990.040)     (-1.3%)
</span></span><span class=line><span class=cl>    Cpufreq OPP: 1800    Measured: 1812 (1812.294/1812.174/1812.055)
</span></span><span class=line><span class=cl>    Cpufreq OPP: 1608    Measured: 1604 (1604.397/1604.319/1604.203)
</span></span><span class=line><span class=cl>    Cpufreq OPP: 1416    Measured: 1421 (1421.929/1421.837/1421.837)
</span></span><span class=line><span class=cl>    Cpufreq OPP: 1200    Measured: 1214 (1214.996/1214.968/1214.912)     (+1.2%)
</span></span><span class=line><span class=cl>    Cpufreq OPP: 1008    Measured: 1019 (1019.959/1019.934/1019.910)     (+1.1%)
</span></span><span class=line><span class=cl>    Cpufreq OPP:  816    Measured:  818    (818.552/818.433/818.394)
</span></span><span class=line><span class=cl>    Cpufreq OPP:  600    Measured:  592    (592.906/592.893/592.854)     (-1.3%)
</span></span><span class=line><span class=cl>    Cpufreq OPP:  408    Measured:  394    (394.950/394.905/394.887)     (-3.4%)
</span></span></code></pre></td></tr></table></div></div><p>可以看到，实际只有2.2GHz，和2.4GHz足足差了200MHz, 6.5%，确实很糟糕了。。。</p><h2 id=内存>内存</h2><p>查看频率：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    cat /sys/class/devfreq/dmc/cur_freq
</span></span><span class=line><span class=cl>    cat /sys/kernel/debug/clk/clk_summary | grep ddr
</span></span></code></pre></td></tr></table></div></div><blockquote><p>官方说明： The ram for ROCK 5B is LPDDR 4x, two 32bits LPDDR 4x chips make 64bits, data frequency is up to 4224Mhz. ROCK 5B offers 4GB, 8GB and 16GB ram size options.</p></blockquote><p>可以看到实际频率 <code>1068000000， 1GHz</code>， 查看可用频率</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    cat /sys/class/devfreq/dmc/available_frequencies
</span></span><span class=line><span class=cl>    528000000 1068000000 1560000000 2112000000
</span></span><span class=line><span class=cl>    # 设置 DDR 频率，例如，设置 1560MHz
</span></span><span class=line><span class=cl>    echo userspace &gt; /sys/class/devfreq/dmc/governor
</span></span><span class=line><span class=cl>    echo 1560000000 &gt; /sys/class/devfreq/dmc/userspace/set_freq
</span></span></code></pre></td></tr></table></div></div><h2 id=hdmi输出>HDMI输出</h2><p>到此为止，HDMI 仍然没有输出，我的显示器是 2k(2560x1440)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    cat /sys/class/drm/card0-HDMI-A-1/modes
</span></span></code></pre></td></tr></table></div></div><p>发现没有 2k 的分辨率</p><p>换个 1080p 的显示器接上 HDMI，立马亮了，终端界面tty1出现了，没有桌面。</p><p>另外，在使用 debian 系统后，可以直接输出 1080p和4k输出，但均没有 2k 输出可以直接使用， 不过有个最简单的方法就是设置为 4k60fps，然后设置缩放200%即可，因为性能足够， 4k 也不卡。</p><h2 id=armbian>Armbian</h2><p>Armbian 适配得更好一点，推荐使用
因为 GPU 驱动大多需要在 wayland 模式下使用，可以设置默认登录到 wayland 窗口管理模式，这样就不用每次登录时选择一次了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    sudo vim /etc/gdm3/custom.conf
</span></span></code></pre></td></tr></table></div></div><p>修改<code>WaylandEnable=true</code></p><p>另外，官网提供的链接不是最新的，可以到github.com/armbian/build/releases 找最新的。
另外， github.com/amazingfate/armbian-rock5b-images 据说是内置了 GPU 相关的驱动，在官方还没完全支持 GPU 前可以尝试这个，具体看后面 GPU 使用部分。</p><h2 id=从nvme启动>从NVME启动</h2><p>SD 卡会比较慢，据说太慢还会影响到快充握手，因为快充握手协议是在系统驱动里面的，所以最好用 eMMc 或者 nvme ssd 或者 USB 启动读写更快。</p><p>启动流程: 内部有个叫 maskrom 的固件，会优先启动 SPI nor Flash -> sd -> eMMC</p><p>默认不支持从 nvme 启动，所以需要额外的引导，将引导保存到 SPI nor Flash中，然后这个固件再引导nvme的系统启动。</p><p>于是需要先更新 Nor Flash 的固件，使用 rk 官方的 rkdevtool，注意不能直接就给 nor flash 下载固件，还需要先给 maskrom 传一个用来和 rkdevtool 通讯以及写 flash 等操作的固件，这里名字叫 <code>rk*_spl_loader.bin</code>，这个固件只会临时运行在内存中。</p><p>装 USB 驱动，然后打开 rkdevtool， 按住 maskroom 按钮，上电，软件会检测到设备。
<code>Write by address</code> 默认没勾上，注意勾上</p><p><img src=/p/rock5b/rkdevtool.jpg width=974 height=458 srcset="/p/rock5b/rkdevtool_hu17774ee5a71472fc38eea878b144ecc1_136042_480x0_resize_q75_box.jpg 480w, /p/rock5b/rkdevtool_hu17774ee5a71472fc38eea878b144ecc1_136042_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt=rkdevtool class=gallery-image data-flex-grow=212 data-flex-basis=510px></p><p>然后下载系统，可以用官方的 debian 或者 armbian</p><p>armbian 页面有些提示比如带硬件加速的 kodi 使用</p><blockquote><p>PD is broken on most revisions that are in the wild and is causing boot loop. Workaround is to use stupid / fixed at 5 volts USB-C power supply.
NVME boot can work with eMMC/SD boot or SPI. Check those instructions to install / update SPI boot loader.
In order to enable 3D acceleration:</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    sudo add-apt-repository ppa:liujianfeng1994/panfork-mesa
</span></span><span class=line><span class=cl>    sudo add-apt-repository ppa:liujianfeng1994/rockchip-multimedia
</span></span><span class=line><span class=cl>    sudo apt update
</span></span><span class=line><span class=cl>    sudo apt dist-upgrade
</span></span><span class=line><span class=cl>    sudo apt install kodi
</span></span></code></pre></td></tr></table></div></div><p>没买 m.2 转 USB转接器，所以直接把 nvme ssd 装到板子上，然后用 SD 卡进 debian 系统</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    rock@rock-5b:~$ lsblk
</span></span><span class=line><span class=cl>    NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
</span></span><span class=line><span class=cl>    mtdblock0    31:0    0    16M  0 disk
</span></span><span class=line><span class=cl>    mmcblk1     179:0    0  29.2G  0 disk
</span></span><span class=line><span class=cl>    ├─mmcblk1p1 179:1    0   512M  0 part /boot
</span></span><span class=line><span class=cl>    └─mmcblk1p2 179:2    0  28.6G  0 part /
</span></span><span class=line><span class=cl>    nvme0n1     259:0    0 931.5G  0 disk
</span></span></code></pre></td></tr></table></div></div><p>可以看到 直接能读到 nvme0n1，直接操作这个固态即可，因为是初次测试，硬盘也是空的，直接</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    sudo xzcat  Armbian_22.11.2_Rock-5b_jammy_legacy_5.10.110_gnome_desktop.img.xz | sudo dd of=/dev/nvme0n1 bs=1M status=progress
</span></span></code></pre></td></tr></table></div></div><p>写入完成后</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    nvme0n1     259:0    0 931.5G  0 disk
</span></span><span class=line><span class=cl>    ├─nvme0n1p1 259:1    0   256M  0 part
</span></span><span class=line><span class=cl>    └─nvme0n1p2 259:2    0   6.8G  0 part
</span></span></code></pre></td></tr></table></div></div><p>然后断电，拔掉 SD 卡上电即可从 nvme ssd 中的系统启动</p><p>进系统后看看接口情况</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    sudo dmidecode | grep --color &#34;PCI&#34;
</span></span></code></pre></td></tr></table></div></div><p>speed test:
iozone, fio</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    iozone -e -I -a -s 100M -r 4k -r 16k -r 512k -r 1024k -r 16384k -i 0 -i 1 -i 2
</span></span><span class=line><span class=cl>                                                                 random    random     bkwd    record    stride                                    
</span></span><span class=line><span class=cl>                  kB  reclen    write  rewrite    read    reread    read     write     read   rewrite      read   fwrite frewrite    fread  freread
</span></span><span class=line><span class=cl>              102400       4   131760   167822   191255   204110    49352   108890                                                                
</span></span><span class=line><span class=cl>              102400      16   400881   478178   340041   289103   164730   277126                                                                
</span></span><span class=line><span class=cl>              102400     512  1444041  1676845  1619100  1573208  1314692  1723524                                                                
</span></span><span class=line><span class=cl>              102400    1024  1797630  1854966  1684764  1714470  1559952  1803609                                                                
</span></span><span class=line><span class=cl>              102400   16384  2478047  2356570  2140251  2189357  2261106  2410056
</span></span></code></pre></td></tr></table></div></div><p>可以看到 我的 SSD 是三星的 970 evo plus, 是支持 nvme3x4 的，1M 读写 分别是 1.68GB/s 1.79GB/s</p><p>虽然都是 PCIE3.0x4 接口，可以看到顺序读写都没有达到在电脑上 3.5GB/s 和 3.3GB/s 的水平，在板子上只能有 2.1GB/s 和 2.5GB/s，读写速度甚至没有写入速度高，随机 4k 读写也只能到 50MB/s 和 108MB/s，远远低于上面测评中的 >= 800MB/s，可见，开发板（armbian22）远远没有跑满 PCIE3.0x4 的速度，暂时不知是硬件还是软件的问题，以后发现了补上</p><p>另外，需要考虑散热问题，固态的发热量挺大的！可以通过<code>/dev/nvme0n1</code>看到固态温度</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    sudo apt install nvme-cli
</span></span><span class=line><span class=cl>    sudo nvme smart-log /dev/nvme0 |grep -i &#34;^Temperature&#34;
</span></span></code></pre></td></tr></table></div></div><h2 id=gpu-硬件解码>GPU 硬件解码</h2><p>装好 armbian 发现自带的 mpv 播放器只能软解，跑个 4k 直接把 CPU 吃得差不多一卡一卡。</p><p>按照 armbian 下载页面的源装了 kodi，不能直接用只能放声音没有画面，是因为无法解码导致的。</p><p>参考这个帖子的步骤即可（可以直接重装系统，amazingfate 打包了带这些软件包的系统，也可以自己手动更新包，自己更新会麻烦一点）：https://forum.radxa.com/t/rk3588-kodi-rkmpp-accelerated-decoding-working-out-of-box/12785/2 和 <a class=link href=https://forum.armbian.com/topic/24802-kodi-for-rk35xx-510-legacy-kernel/ target=_blank rel=noopener>https://forum.armbian.com/topic/24802-kodi-for-rk35xx-510-legacy-kernel/</a></p><blockquote><p>以及 GPU 相关也可以参考玩 我的世界 的帖子： <a class=link href=https://forum.radxa.com/t/guide-run-minecraft-at-full-speed-on-rock-5b/11937/8 target=_blank rel=noopener>https://forum.radxa.com/t/guide-run-minecraft-at-full-speed-on-rock-5b/11937/8</a></p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    You have to create the following udev rules to enable mpp and rga hardware acceleration:
</span></span><span class=line><span class=cl>    KERNEL==&#34;mpp_service&#34;, MODE=&#34;0660&#34;, GROUP=&#34;video&#34;
</span></span><span class=line><span class=cl>    KERNEL==&#34;rga&#34;, MODE=&#34;0660&#34;, GROUP=&#34;video&#34;
</span></span><span class=line><span class=cl>    KERNEL==&#34;system-dma32&#34;, MODE=&#34;0666&#34;, GROUP=&#34;video&#34;
</span></span><span class=line><span class=cl>    KERNEL==&#34;system-uncached-dma32&#34;, MODE=&#34;0666&#34;, GROUP=&#34;video&#34; RUN+=&#34;/usr/bin/chmod a+rw /dev/dma_heap&#34;
</span></span><span class=line><span class=cl>    to /etc/udev/rules.d/11-rockchip-multimedia.rules
</span></span><span class=line><span class=cl>    To enable libv4l-rkmpp for chromium, you have to install libv4l-rkmpp, v4l-utils and chromium-browser in this ppa:
</span></span><span class=line><span class=cl>    sudo apt install chromium-browser=$(apt-cache show chromium-browser|grep Version|grep rkmpp|cut -d &#34; &#34; -f2) chromium-codecs-ffmpeg-extra=$(apt-cache show chromium-browser|grep Version|grep rkmpp|cut -d &#34; &#34; -f2) libv4l-rkmpp, v4l-utils
</span></span><span class=line><span class=cl>    Then run the following commands:
</span></span><span class=line><span class=cl>    sudo ln -s /lib /usr/lib64
</span></span><span class=line><span class=cl>    cd /usr/lib64/ &amp;&amp; sudo ln -s aarch64-linux-gnu/libv4l2.so.0.0.0 libv4l2.so
</span></span><span class=line><span class=cl>    And add the following lines to /etc/rc.local:
</span></span><span class=line><span class=cl>    echo dec &gt; /dev/video-dec0
</span></span><span class=line><span class=cl>    chown root:video /dev/video-dec0
</span></span><span class=line><span class=cl>    chmod 0660 /dev/video-dec0
</span></span><span class=line><span class=cl>    echo enc &gt; /dev/video-enc0
</span></span><span class=line><span class=cl>    chown root:video /dev/video-enc0
</span></span><span class=line><span class=cl>    chmod 0660 /dev/video-enc0
</span></span><span class=line><span class=cl>    Add chrome flags &#34;--use-gl=egl&#34; to /etc/chromium-browser/default:
</span></span><span class=line><span class=cl>    CHROMIUM_FLAGS=&#34;--use-gl=egl&#34;
</span></span><span class=line><span class=cl>    ==================================================
</span></span><span class=line><span class=cl>    chromium related FYI: https://github.com/JeffyCN/libv4l-rkmpp
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    sudo add-apt-repository ppa:liujianfeng1994/panfork-mesa
</span></span><span class=line><span class=cl>    sudo apt update
</span></span><span class=line><span class=cl>    wget https://github.com/JeffyCN/rockchip_mirrors/raw/libmali/firmware/g610/mali_csffw.bin
</span></span><span class=line><span class=cl>    sudo mv mali_csffw.bin /lib/firmware
</span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-tags><a href=/tags/toss/>toss</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/%E5%AE%89%E8%A3%85macos9.2.2%E4%B8%AD%E6%96%87%E7%89%88/><div class=article-image><img src=/p/%E5%AE%89%E8%A3%85macos9.2.2%E4%B8%AD%E6%96%87%E7%89%88/check.a83fa70afbe5868b1f3289193607d298_hu8c2f981c015ea3229faa34cd44b665d2_5645822_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post 安装MacOS9.2.2中文版" data-hash="md5-qD+nCvvlhosfMokZNgfSmA=="></div><div class=article-details><h2 class=article-title>安装MacOS9.2.2中文版</h2></div></a></article><article class=has-image><a href=/p/asus-chromebook/><div class=article-image><img src=/p/asus-chromebook/overview.0785b5c17248197684c6d8b70cd92a18_hu0625a79d9e7cdc506fe21654cede939b_133150_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post 折腾ArchLinux on Chromebook" data-key=asus-chromebook data-hash="md5-B4W1wXJIGXaExti3DNkqGA=="></div><div class=article-details><h2 class=article-title>折腾ArchLinux on Chromebook</h2></div></a></article></div></div></aside><div id=gitalk-container></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css><script src=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/blueimp-md5@2.18.0/js/md5.min.js></script>
<script>const gitalk=new Gitalk({clientID:"e61b02a69a03b3124057",clientSecret:"4880b2ae64284f63f338dd2ee61ad9b5af77d47d",repo:"sharelter.github.io",owner:"Sharelter",admin:["Sharelter"],distractionFreeMode:!1,id:md5(location.pathname)});(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("gitalk-container").innerHTML="Gitalk comments not available by default when the website is previewed locally.";return}gitalk.render("gitalk-container")})()</script><footer class=site-footer><section class=copyright>&copy;
2022 -
2023 Sharelter</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.16.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>